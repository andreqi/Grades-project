function getOffsetRect(a){var b=a.getBoundingClientRect(),c=document.body,d=document.documentElement,e=window.pageYOffset||d.scrollTop||c.scrollTop,f=window.pageXOffset||d.scrollLeft||c.scrollLeft,g=d.clientTop||c.clientTop||0,h=d.clientLeft||c.clientLeft||0,i=b.top+e-g,j=b.left+f-h;return{top:i-3,left:j-1}}function bindEdit(a,b,c){c=c||function(){};var d=document.createElement("input");c(d),d.value=a.textContent;var e=getOffsetRect(a),f=d.style,g=getComputedStyle(a);f.resize="none",f.position="absolute",f.background="none",f.left=e.left+"px",f.top=e.top+"px",f.width=Math.round(a.getBBox().width+20)+"px",f.height=Math.round(g.heigth)+"px",f["font-family"]=g["font-family"],f["font-size"]=g["font-size"],f["font-weight"]=g["font-weight"],f.outline="none",f.overflow="hidden",f.border="0 none #FFF",f["-webkit-transform-origin"]="center center",f["z-index"]=3;var h=function(){var c=d.value.trim();c&&(a.textContent=b(c)),$(d).hide(),$(d).remove(),a.style.display=""};$(d).focusout(h),$(d).keyup(function(a){13==a.which&&h()}),a.style.display="none",document.body.appendChild(d),d.focus()}function Edge(a,b,c){var d=a,e=b,f=c;d3.select(f).attr("x1",d.x).attr("y1",d.y).attr("x2",e.x).attr("y2",e.y);var g={moveTo:function(a,b){return function(){d=a,e=b,d3.select(f).transition().duration(1e3).style("display","").attr("x1",d.x).attr("y1",d.y).attr("x2",e.x).attr("y2",e.y)}},hide:function(){d3.select(f).style("display","none")}};return g}function Node(a,b,c){function d(a,b){return{x:a.x+b*w.width/2,y:a.y+b*w.height/2}}function e(a){var b=["max","min"];b.forEach(function(b){var c=d3.select(m).select("#"+b).node();c.textContent=f(c.textContent,{zeroPadding:!0,decimals:a})})}function f(a,b){var c=i,d=!0;arguments.length>1&&(c=b.decimals,d=b.zeroPadding);var e="",f=a.match(/(\d*)[.]?(\d*)/),g=f[1],h=f[2].substr(0,c);return d&&(g=Array(3-g.length).join("0")+g,h+=Array(1+c-h.length).join("0")),e=0==c?g:g+"."+h}var g=a,h=!0,i=2,j=!1,g=a,h=!0,k=null,l=null,m=b,n=1,o={upper:20,lower:0},p=[],q=["R","T"],r=["N","E"],s=0,t=0,u=d3.select(m).select("#trunk-behavior"),v=d3.select(m).select("#delete-min"),w={width:96,height:109},x={setData:function(a){x.setDecimals(a.decimals),x.setLabel(a.label),x.setBounds(a.bounds),x.setTrunkBehavior(a.trunk),x.setWeight(a.weight),x.setDeleteMinimum(a.deleteMin)},setDecimals:function(a){i=a,e(a)},setLabel:function(a){a&&""!=a||(a="-"),k=a,d3.select(m).select("#label").text(k)},setTrunkBehavior:function(a){u.text(q[a]),s=s},setDeleteMinimum:function(a){v.text(r[a]),t=a},setEditable:function(a){h=a},setOrigin:function(a,b){l=d(a,-1),b&&d3.select(m).attr("transform","translate("+l.x+","+l.y+")")},setWeight:function(a){a||(a=1),n=parseInt(a),d3.select(m).select("#weight").text(a)},getOrigin:function(){return d(l,1)},getChildren:function(){return p},addChild:function(a){p.push(a)},setBounds:function(a){o=a,d3.select(m).select("#min").node().textContent=f(""+o.lower),d3.select(m).select("#max").node().textContent=f(""+o.upper)},getPrecision:function(){return+Math.pow(10,i)},shouldRound:function(){return 0==s},getWeight:function(){return n},shouldDeleteMinimum:function(){return 1==t},getBounds:function(){return h?o:{upper:20,lower:0}},moveTo:function(a){return x.setOrigin(a),function(){d3.select(m).select("#container").classed("leaf",h),x.show(),d3.select(m).transition().duration(1e3).attr("transform","translate("+l.x+","+l.y+")")}},show:function(){d3.select(m).style("display","")},hide:function(){d3.select(m).style("display","none")},showControls:function(){j=!0,d3.select(m).select("#controls").style("display","")},hideControls:function(){j=!1,d3.select(m).select("#controls").style("display","none")},toggleControls:function(){j?x.hideControls():x.showControls()},formatFormula:function(){return{bounds:o,children:[],decimals:i,deleteMin:t,isEditable:h,label:k,trunk:s,weight:n}}};return c&&x.setData(c),d3.select(m).select("#data").on("click",function(){var a=d3.event.target;if(a.id)switch(a.id){case"container":x.toggleControls();break;case"label":bindEdit(a,function(a){return k=a,a});break;default:if(!h&&"weight"!=a.id)return;bindEdit(a,function(b){var c=f(b);return"max"==a.id?o.upper=parseFloat(c):"min"==a.id?o.lower=parseFloat(c):"weight"==a.id&&(c=f(b,{zeroPadding:!1,decimals:0}),n=parseInt(c)),NodeMgr.simulate(),c},function(b){b.type="number",b.min="0",b.max="20",b.step="weight"==a.id?"1":""+Math.pow(10,-i)})}}),d3.select(m).select("#add").on("click",function(){NodeMgr.addNode(g)}).style("pointer-events","bounding-box"),d3.select(m).select("#remove").on("click",function(){NodeMgr.removeNode(g)}).style("pointer-events","bounding-box"),u.on("click",function(){s=1-s,u.text(q[s]),NodeMgr.simulate()}).style("pointer-events","bounding-box"),v.on("click",function(){t=1-t,v.text(r[t]),NodeMgr.simulate()}).style("pointer-events","bounding-box"),d3.select(m).select("#inc-decimals").on("click",function(){i++,i>2&&(i=2),NodeMgr.simulate(),e(i)}).style("pointer-events","bounding-box"),d3.select(m).select("#dec-decimals").on("click",function(){i--,0>i&&(i=0),NodeMgr.simulate(),e(i)}).style("pointer-events","bounding-box"),x}!function(a,b){"object"==typeof exports?module.exports=b():"function"==typeof define&&define.amd?define(b):a.Spinner=b()}(this,function(){"use strict";function a(a,b){var c,d=document.createElement(a||"div");for(c in b)d[c]=b[c];return d}function b(a){for(var b=1,c=arguments.length;c>b;b++)a.appendChild(arguments[b]);return a}function c(a,b,c,d){var e=["opacity",b,~~(100*a),c,d].join("-"),f=.01+c/d*100,g=Math.max(1-(1-a)/b*(100-f),a),h=j.substring(0,j.indexOf("Animation")).toLowerCase(),i=h&&"-"+h+"-"||"";return l[e]||(m.insertRule("@"+i+"keyframes "+e+"{0%{opacity:"+g+"}"+f+"%{opacity:"+a+"}"+(f+.01)+"%{opacity:1}"+(f+b)%100+"%{opacity:"+a+"}100%{opacity:"+g+"}}",m.cssRules.length),l[e]=1),e}function d(a,b){var c,d,e=a.style;for(b=b.charAt(0).toUpperCase()+b.slice(1),d=0;d<k.length;d++)if(c=k[d]+b,void 0!==e[c])return c;return void 0!==e[b]?b:void 0}function e(a,b){for(var c in b)a.style[d(a,c)||c]=b[c];return a}function f(a){for(var b=1;b<arguments.length;b++){var c=arguments[b];for(var d in c)void 0===a[d]&&(a[d]=c[d])}return a}function g(a,b){return"string"==typeof a?a:a[b%a.length]}function h(a){this.opts=f(a||{},h.defaults,n)}function i(){function c(b,c){return a("<"+b+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',c)}m.addRule(".spin-vml","behavior:url(#default#VML)"),h.prototype.lines=function(a,d){function f(){return e(c("group",{coordsize:k+" "+k,coordorigin:-j+" "+-j}),{width:k,height:k})}function h(a,h,i){b(m,b(e(f(),{rotation:360/d.lines*a+"deg",left:~~h}),b(e(c("roundrect",{arcsize:d.corners}),{width:j,height:d.width,left:d.radius,top:-d.width>>1,filter:i}),c("fill",{color:g(d.color,a),opacity:d.opacity}),c("stroke",{opacity:0}))))}var i,j=d.length+d.width,k=2*j,l=2*-(d.width+d.length)+"px",m=e(f(),{position:"absolute",top:l,left:l});if(d.shadow)for(i=1;i<=d.lines;i++)h(i,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(i=1;i<=d.lines;i++)h(i);return b(a,m)},h.prototype.opacity=function(a,b,c,d){var e=a.firstChild;d=d.shadow&&d.lines||0,e&&b+d<e.childNodes.length&&(e=e.childNodes[b+d],e=e&&e.firstChild,e=e&&e.firstChild,e&&(e.opacity=c))}}var j,k=["webkit","Moz","ms","O"],l={},m=function(){var c=a("style",{type:"text/css"});return b(document.getElementsByTagName("head")[0],c),c.sheet||c.styleSheet}(),n={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",direction:1,speed:1,trail:100,opacity:.25,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",position:"absolute"};h.defaults={},f(h.prototype,{spin:function(b){this.stop();var c=this,d=c.opts,f=c.el=e(a(0,{className:d.className}),{position:d.position,width:0,zIndex:d.zIndex});if(d.radius+d.length+d.width,e(f,{left:d.left,top:d.top}),b&&b.insertBefore(f,b.firstChild||null),f.setAttribute("role","progressbar"),c.lines(f,c.opts),!j){var g,h=0,i=(d.lines-1)*(1-d.direction)/2,k=d.fps,l=k/d.speed,m=(1-d.opacity)/(l*d.trail/100),n=l/d.lines;!function o(){h++;for(var a=0;a<d.lines;a++)g=Math.max(1-(h+(d.lines-a)*n)%l*m,d.opacity),c.opacity(f,a*d.direction+i,g,d);c.timeout=c.el&&setTimeout(o,~~(1e3/k))}()}return c},stop:function(){var a=this.el;return a&&(clearTimeout(this.timeout),a.parentNode&&a.parentNode.removeChild(a),this.el=void 0),this},lines:function(d,f){function h(b,c){return e(a(),{position:"absolute",width:f.length+f.width+"px",height:f.width+"px",background:b,boxShadow:c,transformOrigin:"left",transform:"rotate("+~~(360/f.lines*k+f.rotate)+"deg) translate("+f.radius+"px,0)",borderRadius:(f.corners*f.width>>1)+"px"})}for(var i,k=0,l=(f.lines-1)*(1-f.direction)/2;k<f.lines;k++)i=e(a(),{position:"absolute",top:1+~(f.width/2)+"px",transform:f.hwaccel?"translate3d(0,0,0)":"",opacity:f.opacity,animation:j&&c(f.opacity,f.trail,l+k*f.direction,f.lines)+" "+1/f.speed+"s linear infinite"}),f.shadow&&b(i,e(h("#000","0 0 4px #000"),{top:"2px"})),b(d,b(i,h(g(f.color,k),"0 0 1px rgba(0,0,0,.1)")));return d},opacity:function(a,b,c){b<a.childNodes.length&&(a.childNodes[b].style.opacity=c)}});var o=e(a("group"),{behavior:"url(#default#VML)"});return!d(o,"transform")&&o.adj?i():j=d(o,"animation"),h});var api=function(){var a={lines:7,length:3,width:9,radius:14,corners:1,rotate:38,direction:1,color:"#000",speed:1,trail:50,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"50%",left:"50%"},b=function(b,c,d){var e=document.getElementById("spin"),f=new Spinner(a).spin(e);$.ajax({type:"POST",url:b,data:JSON.stringify(c)||{},contentType:"application/json; charset=UTF-8",dataType:"json",success:function(a){f.stop(),$("#spin").remove(),d(a)},error:function(a,b,c){d({msg:c})}})},c={getCourses:"User/getCourses",addCourse:"Course/add",searchCourse:"Course/search",createCourse:"Course/create",updateCourse:"Course/update",getFormulaCourse:"Course/getFormula",shareCourse:"Course/share",deleteCourse:"Course/del",contactForm:"contact"};return{consume:function(a,d,e){b(c[a],d,e)}}}(),courseSearch=function(a,b,c){var d=a,b=b,c=c,e=$("#course-search"),f=$("#course-search-box"),g=$("#btn-search"),h=$("#search-results"),i=$("#remove-search"),j=$("#no-results"),k=$("#new-course");k.on("click",function(){l.new_course_handler(f.val()),j.hide()}),i.on("click",function(){h.children().remove(),f.val(""),j.hide()}),g.on("click",function(){e.submit()});var l={selected_handler:null,add_handler:null,new_course_handler:null,remove:null},m=function(a,b){l.selected_handler&&d.consume("getFormulaCourse",{id:a._id},function(c){l.selected_handler(c,b),$("#save-formula").text("Agregar").on("click",function(b){o(a._id),b.stopPropagation()})})},n=function(a){a.remove(),l.remove()},o=function(a){d.consume("addCourse",{id:a},function(a){return a.msg&&"OK"!=a.msg?console.log("error",a.msg):(b.show_info_msg(c.course_adquired),l.remove(),void l.add_handler(a))})},p=function(a){var b='<li class="course"><a><span class="name">'+a.name+'</span><span class="menu-icon click-menu"><span class="remove glyphicon glyphicon-remove" title="Eliminar de búsqueda"></span></a></a></li>';return $(b)};e.on("submit",function(a){a.preventDefault();var e=f.val();return e&&e.length?e.length>30?void b.show_err_submit(f,c.input_max_length):void d.consume("searchCourse",{name:e},function(a){if(j.hide(),a.msg)return console.log("error",a.msg);h.empty(),a.length||j.show();for(var b=0;b<a.length;b++)q(a[b])}):void b.show_err_submit(f,c.input_required)});var q=function(a){var b=p(a);b.find(".remove").on("click",function(a){n(b),a.stopPropagation()}),b.find("a").on("click",function(){m(a,b)}),h.append(b)};return l},course=function(a,b,c){var d=a,b=b,c=c,e=$("#course-list"),f=$("#my-courses");f.on("click",function(){e.toggle()});var g=function(a){var e={name:a};d.consume("createCourse",e,function(a){return a.msg?console.log("error",a.msg):(p(a),void b.show_ok_msg(c.course_create_ok))})},h=function(a,b){s.selected_handler&&d.consume("getFormulaCourse",{id:a._id},function(c){s.selected_handler(c,b),$("#save-formula").on("click",function(){l(a._id)}).text("Guardar")})},i=function(a){d.consume("shareCourse",{id:a},function(a){return"OK"!=a.msg?console.log("error",a.msg):void b.show_ok_msg(c.course_share_ok)})},j=function(a){$("html").on("click.edit",function(){a(),k()})},k=function(){$("html").off("click.edit")},l=function(a){var e=s.get_formula(),f={id:a,formula:e.formula,baseFormula:e.baseFormula};d.consume("updateCourse",f,function(a){return"OK"!=a.msg?console.log("error".res.msg):void b.show_ok_msg(c.course_edit_ok)})},m=function(a,e){var f=e.children().first(),g=$('<span class="clearfix edit-menu"><input type="text" value="'+f.find(".name").text()+'" class="name pull-left"><span class="menu-icon"><span class="ok glyphicon glyphicon-ok"></span><span class="cancel glyphicon glyphicon-remove"></span></span></span>');f.hide();var h=function(){g.remove(),f.show()};j(h),g.on("click",function(a){a.stopPropagation()}),g.find(".ok").on("click",function(e){var i={id:a._id,name:g.find(".name").val()};return i.name&&i.name.length?i.name.length>30?(b.show_err_submit(g.find(".name"),c.input_max_length),void e.stopPropagation()):void d.consume("updateCourse",i,function(a){return"OK"!=a.msg?console.log("error".res.msg):(b.show_ok_msg(c.course_edit_ok),f.find(".name").text(i.name),h(),void e.stopPropagation())}):(b.show_err_submit(g.find(".name"),c.input_required),void e.stopPropagation())}),g.find(".cancel").on("click",function(){h()}),e.append(g)},n=function(a,e){d.consume("deleteCourse",{id:a},function(a){return"OK"!=a.msg?console.log("error".res.msg):(e.remove(),b.show_ok_msg(c.course_remove_ok),void s.remove())})},o=function(a){var b='<li class="course"><a><span class="name">'+a.name+'</span><span class="menu-icon click-menu"><span class="share glyphicon glyphicon-cloud" title="Compartir"></span><span class="edit glyphicon glyphicon-pencil" title="Editar"></span><span class="remove glyphicon glyphicon-remove" title="Eliminar"></span></a></a></li>';return $(b)},p=function(a){var b=o(a);b.find("a").on("click",function(){h(a,b)}),b.find(".share").on("click",function(b){i(a._id),b.stopPropagation()}),b.find(".edit").on("click",function(c){m(a,b),c.stopPropagation()}),b.find(".remove").on("click",function(c){n(a._id,b),c.stopPropagation()}),e.append(b)},q=function(a){p(a),l(a._id)},r=function(){d.consume("getCourses",{},function(a){for(var b=a.courses,c=(b?b.length:0,0);c<b.length;c++)p(b[c])})};r();var s={selected_handler:null,add:q,create:g,get_formula:null,remove:null};return s},strings={course_create_ok:"Curso creado.",course_edit_ok:"Información actualizada.",course_remove_ok:"Curso eliminado.",course_share_ok:"Curso compartido.",course_error:"GG feeder",course_adquired:"Curso agregado. Puede buscarlo en Mis Cursos",input_required:"Campo obligatorio",input_max_length:"Max. 30 caracteres",base_formula_to_tree:"La estructura base fue creada. Debes agregar la cantidad de evaluaciones bajo la estructura actual. Además debes establecer si se debe elmiminar la mínima nota en algún promedio."},NodeMgrGen=function(a,b,c,d){function e(a){var b=null,c=0,d=0,e=[],f=0,g=0,h={isRoot:function(){return null==b},getPrev:function(){return b},removeChild:function(a){var b=e.indexOf(a);-1!=b&&(d--,e.splice(b,1))},setPrev:function(a){b=a},isLeaf:function(){return 0==d},push:function(a){d++,e.push(a)},setLeafNumber:function(a){c=a},setOffset:function(a){g=a},getOffset:function(){return g},getWidth:function(){return f},setWidth:function(a){f=a},forEachChild:function(a){e.forEach(a)},getLeafNumber:function(){return c},adjSize:function(){return d}};return h}function f(a,b){{var c=h(a);n(a)}c&&(c.forEachChild(function(a){f(a,b)}),b(a))}function g(a){return p[a]}function h(a){return q[a]}function i(){function a(){return{leafs:0,width:0}}function b(){return{leafs:1,width:70,offset:5}}function c(a,b){return{leafs:a.leafs+b.leafs,width:a.width+b.width+(a.width?b.offset:0),offset:b.offset}}function d(a,b){a.setLeafNumber(b.leafs),a.setWidth(b.width),a.setOffset(b.offset)}function e(f){var g=h(f);if(!g)return a();if(g.isLeaf()){var i=b();return d(g,i),i}var j=a();return g.forEachChild(function(a){var b=e(a);j=c(j,b)}),j.width+=20,d(g,j),j}e(t)}function j(){function a(b,c,d){var e=h(b);if(e){var f=n(b);if(f.moveTo({x:c,y:d})(),!e.isRoot()){var i=n(e.getPrev()),j=f,k=g(b);k.moveTo(i.getOrigin(),j.getOrigin())()}if(!e.isLeaf()){var l=c-e.getWidth()/2+10;e.forEachChild(function(b){child=h(b);var c=child.getWidth()/2;l+=c,a(b,l,d+110),l+=c+child.getOffset()})}}}var b=s.getOrigin();a(t,b.x,b.y)}function k(){var a=function(b){var c=h(b),d=n(b),e=0,f={lower:0,upper:0},g={lower:21,upper:21},i={lower:0,upper:0},j={lower:0,upper:0};if(c.isLeaf())return d.getBounds();c.forEachChild(function(b){var c=a(b),d=n(b),h=d.getWeight();f.lower+=c.lower*h,f.upper+=c.upper*h,e+=h,c.lower<g.lower&&(g.lower=c.lower,i.lower=h),c.upper<g.upper&&(g.upper=c.upper,i.upper=h)}),j.lower=e,j.upper=e,d.shouldDeleteMinimum()&&(f.lower-=g.lower*i.lower,f.upper-=g.upper*i.upper,j.lower-=i.lower,j.upper-=i.upper),f.lower/=j.lower,f.upper/=j.upper;var k=d.getPrecision(),l=d.shouldRound()?.5:0;return f.lower=Math.floor(f.lower*k+l)/k,f.upper=Math.floor(f.upper*k+l)/k,console.log(j),console.log(f),d.setBounds(f),f};a(t),l()}function l(){i(),j()}function m(){var a=u;return u++,a}function n(a){return o[a]}var o={},p={},q={},p={},r=[],s=null,t=0,u=0,v=c,w={createEdge:function(a,c){var d=n(a),e=n(c),f=b.append("line").style("display","none").attr("stroke","red").node(),g=Edge(d.getOrigin(),e.getOrigin(),f);return p[c]=g,g},createNode:function(b){var c=m();nodeView=v.cloneNode(!0),o[c]=Node(c,nodeView,b),q[c]=e(c),a.node().appendChild(nodeView);var d=o[c],f=q[c],g={id:c,node:d,vertex:f};return g},addNode:function(a,b,c){var d=w.createNode(b),e=d.node,f=d.id,g=d.vertex,i=n(a),j=i.getOrigin(),k=h(a);k.push(f),i.setEditable(!1),g.setPrev(a),e.setOrigin(j,!0);w.createEdge(a,f);return c||l(),w.animateChanges(),d},removeNode:function(a,b){if(a!=t||b){var c=h(a);if(!c.isRoot()){var d=h(c.getPrev());if(d.removeChild(a),d.isLeaf()){var e=n(c.getPrev());e.setEditable(!0)}}f(a,function(a){o[a].hide(),q[a].isRoot()||p[a].hide(),delete o[a],delete q[a],delete p[a]}),w.animateChanges(),l()}},getBBox:function(){if(s){var a=d.x,b=d.x,c=d.y,e=d.y;return f(t,function(d){var f=n(d).getOrigin();a>f.x&&(a=f.x),c>f.y&&(c=f.y),b<f.x&&(b=f.x),e<f.y&&(e=f.y)}),{width:b-a-200,height:e-c-200}}},appendChange:function(a){r.push(a)},animateChanges:function(){r.forEach(function(a){a()}),r=[]},"export":function(){function a(b){var c=h(b),d=o[b].formatFormula();return c.isLeaf()||c.forEachChild(function(b){d.children.push(a(b))}),d}var b=a(t);return b},simulate:k,moveRoot:function(a){d=a,s&&(s.moveTo(a),l())},cleanSvg:function(){s&&(w.removeNode(t,!0),s=null,t=null),a.selectAll("*").remove(),b.selectAll("*").remove()},newTree:function(){w.cleanSvg();var a=w.createNode();s=a.node,t=a.id,s.setOrigin(d,!0),w.appendChange(s.moveTo(d)),w.animateChanges()},"import":function(a){function b(a,c){for(var d=c.children,e=0;e<d.length;e++){var f=w.addNode(a,d[e],!0);b(f.id,d[e])}}w.cleanSvg();var c=w.createNode(a);s=c.node,t=c.id,s.setOrigin(d,!0),w.appendChange(s.moveTo(d)),w.animateChanges(),b(t,a),l()},parseFormula:function(a){a=a.replace(/\s/g,"");var b=a.split("+"),c=function(){var a={bounds:{lower:0,upper:20},decimals:1,deleteMin:0,isEditable:!0,label:null,trunk:1,weight:1,children:[]};return a},d=new c;d.decimals=2,d.label="Pro",d.trunk=0,d.isEditable=!1;for(var e=0;e<b.length;e++){var f=b[e].match("^[0-9]*")[0],g=b[e].substring(f.length);g=g.replace(/\*/g,"");var h=new c;f=f||1,h.label=g,h.weight=f,h.trunk=1,d.children.push(h)}NodeMgr.import(d)}};return w};NodeMgr=null;var main={load:function(a,b){d3.xml("node_template.svg","image/svg+xml",function(c,d){var e=d.documentElement.getElementById("node-template");NodeMgr=NodeMgrGen(d3.select("#nodes"),d3.select("#edges"),e,{x:900,y:60}),window.onresize=main.updateTreeView,main.init(a,b)})},updateTreeView:function(){var a=getComputedStyle($("#grades-container")[0]),b=parseInt(a.width)-parseInt(a.left),c=parseInt(a.height)-34,d=NodeMgr.getBBox();b=Math.max(b,d.width+100),c=Math.max(c,d.height+100),d3.select("#tree-container").attr("height",c).attr("width",b+parseInt(a.left)),NodeMgr.moveRoot({x:b/2,y:60})},init:function(a,b){var c=courseSearch(a,main,b),d=course(a,main,b),e=$("#left-panel"),f=parseInt(e.css("width")),g=$("#toggle-left-panel"),h=$("#help-link"),i=$("#course-base-formula"),j=$("#apply-base-formula"),k=new Tour({steps:[{element:"#help-link",title:"Tour",content:"Empieza el tour, puedes navegar haciendo click en Ant., Sgt. o utilizando las felchas del teclado."},{element:"#course-search-box",title:"Buscar curso",content:"Buscar el curso y guárdalo en tus cursos"},{element:"#course-list",title:"Mis cursos",content:"Los cursos que te pertenecen, puedes compartirlos dando click en el ícono con forma de nube"},{element:"#about",title:"Contacto",content:"Escríbenos sobre sugerencias o dudas.",placement:"left"},{element:"#share",title:"Compartir",content:"Comparte esta página web",placement:"left"},{element:"#help",title:"Ayuda",content:"Obtén ayuda. Si es tu primera vez te recomendamos entrar aquí.",placement:"left"}],template:"<div class='popover tour'><div class='arrow'></div><h3 class='popover-title'></h3><div class='popover-content'></div><div class='popover-navigation'><button class='btn btn-default' data-role='prev'>«</button><span data-role='separator'>&nbsp;</span><button class='btn btn-default' data-role='next'>»</button><button class='btn btn-default' data-role='end'>Cerrar</button></div></div>"});k.init(),h.on("click",function(){k.restart()});var l=function(a){var b=f-parseInt(g.css("left")),c=-1*f-parseInt(e.css("left"));e.animate({left:c+"px"},"slow"),g.animate({left:b+"px"},"slow");{var d=$("#grades-container");$("body").width()}d.animate({left:b+"px"},"slow",main.updateTreeView),a.stopPropagation()};g.on("click",l);var m=function(a,b){$("#left-panel .active").removeClass("active"),i.val(a.baseFormula),b.addClass("active"),$(".click-menu").hide(),$(".on-sel-hide").show(),$("#save-formula").off("click"),$("#course-name").text(a.name),b.find(".click-menu").show(),a.formula?NodeMgr.import(JSON.parse(a.formula)):NodeMgr.newTree(),main.updateTreeView()},n=function(){$("#save-formula").off("click"),$(".on-sel-hide").hide(),$("#course-name").text(""),NodeMgr.cleanSvg()};j.on("click",function(){var a=i.val();a&&a.length?(NodeMgr.parseFormula(a),main.show_info_msg(b.base_formula_to_tree)):main.show_err_submit(i,"Debe ingresar una fórmula","bottom")});var o=function(){var a=JSON.stringify(NodeMgr.export());return{formula:a,baseFormula:i.val()}};d.selected_handler=m,d.get_formula=o,d.remove=n,c.add_handler=d.add,c.selected_handler=m,c.new_course_handler=d.create,c.remove=n},config:{msg_template:{part1:'<div class="alert ',part2:'" role="alert"><button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times</span><span class="sr-only">Close</span></button>',part3:"</div>"}},show_ok_msg:function(a){main.show_msg(a,"alert-success")},show_err_msg:function(a){main.show_msg(a,"alert-danger")},show_info_msg:function(a){main.show_msg(a,"alert-info",1)},show_err_submit:function(a,b,c){c=c||"top",a.tooltip({title:b,placement:c}),a.tooltip("show")},show_msg:function(a,b,c){var d=main.config.msg_template,e=$(d.part1+b+d.part2+a+d.part3);$("#messages").append(e),c||setTimeout(function(){e.fadeOut("slow",function(){e.remove()})},1e3)}};$(function(){main.load(api,strings)});